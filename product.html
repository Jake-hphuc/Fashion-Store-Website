<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>Tất cả Sản phẩm - NOIR VOYAGE</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet"/>
  <style>
    body { font-family: 'Playfair Display', serif; background:#f9f9f9; color:#222; }
    .section-title { font-size:2rem; text-align:center; margin:2.5rem 0 1.5rem; color:#2c2c2c; }
    .card { border:none; border-radius:20px; overflow:hidden; box-shadow:0 4px 20px rgba(0,0,0,0.05); transition:transform .25s; }
    .card:hover{ transform:translateY(-6px); }
    .card-img-top{ height:280px; object-fit:cover; }
    .text-price { font-size:1.05rem; font-weight:700; color:#111; }
    .text-desc { color:#6b6b6b; }
  </style>
</head>
<body>
  <nav class="navbar navbar-expand-lg navbar-light bg-white shadow-sm">
    <div class="container">
      <a class="navbar-brand fw-bold" href="index.html">NOIR VOYAGE</a>
      <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
        <span class="navbar-toggler-icon"></span>
      </button>
      <div class="collapse navbar-collapse justify-content-end" id="navbarNav">
        <ul class="navbar-nav">
          <li class="nav-item"><a class="nav-link" href="thoitrang.html">Trang Chủ</a></li>
          <li class="nav-item"><a class="nav-link" href="cart.html">Giỏ Hàng</a></li>
        </ul>
      </div>
    </div>
  </nav>

  <div class="container py-5">
    <h2 class="section-title">Tất cả sản phẩm</h2>
    <div id="products-grid" class="row g-4"></div>
  </div>

  <!-- optional: your external product.js (if you have it) -->
  <script src="product.js"></script>

  <script>
    // Nếu product.js có biến `products` dạng object categories, flatten nó.
    // Nếu không có, dùng fallback sampleProducts.
    const fallbackProducts = [
      { id: 'p301', name: "Túi xách Chanel", brand:"Chanel", price:188060000, image:"https://www.chanel.com/images/as///f_auto,q_auto:good,dpr_1.1/w_1600/-76161100.jpg", description:"Da bê hiệu ứng hạt" },
      { id: 'p302', name: "Áo khoác Chanel", brand:"Chanel", price:269160000, image:"https://www.chanel.com/images/as///f_auto,q_auto:good,dpr_1.1/w_960/-77458721.jpg", description:"Zipper Jacket – Look 1" },
      { id: 'p303', name: "Valentino Blazer", brand:"Valentino", price:32000000, image:"https://valentino-cdn.thron.com//delivery/public/image/valentino/5cdd9f34-9c1e-44f7-9d84-09f01711cb12/ewl5wb/std/1000x0/post?format=auto&quality=auto-medium", description:"Runway Blazer" }
    ];

    // parse price string like "48.996.700 VNĐ" -> number 48996700
    function parsePriceString(s){
      if (typeof s === 'number') return s;
      return Number(String(s).replace(/[^\d]/g,'')) || 0;
    }

    // getProducts: prefer global `products` (from product.js), else fallback
    function getProductsFromGlobal(){
      if (typeof products !== 'undefined') {
        // products in product.js is an object of arrays
        try {
          const arr = Object.values(products).flat();
          return arr.map((p, i) => {
            return {
              id: p.id || p.name.replace(/\s+/g,'_').toLowerCase() + '_' + (p.id || i),
              name: p.name,
              brand: p.brand || '',
              price: parsePriceString(p.price),
              image: p.image || '',
              description: p.description || ''
            };
          });
        } catch(e){
          console.warn('Không đọc được products, dùng fallback');
          return fallbackProducts;
        }
      } else {
        return fallbackProducts;
      }
    }

    const allProducts = getProductsFromGlobal();

    const grid = document.getElementById('products-grid');
    allProducts.forEach(p => {
      const col = document.createElement('div');
      col.className = 'col-md-4';

      col.innerHTML = `
        <div class="card h-100">
          <img src="${p.image}" class="card-img-top" alt="${p.name}" onerror="this.src='https://via.placeholder.com/600x400?text=No+Image'">
          <div class="card-body text-center">
            <h5 class="card-title">${p.name}</h5>
            <p class="text-desc">${p.description || p.brand}</p>
            <p class="text-price">${p.price.toLocaleString('vi-VN')}₫</p>
            <div class="d-grid gap-2">
              <button class="btn btn-dark" onclick='addToCart(${JSON.stringify(p)})'>Thêm vào giỏ hàng</button>
              <button class="btn btn-outline-primary" onclick='buyNow(${JSON.stringify(p)})'>Mua ngay</button>
            </div>
          </div>
        </div>
      `;
      grid.appendChild(col);
    });

    /* ---------- Cart functions (store in localStorage) ---------- */
    function getCart(){ try { return JSON.parse(localStorage.getItem('cart')) || []; } catch(e){ return []; } }
    function setCart(cart){ localStorage.setItem('cart', JSON.stringify(cart)); }

    function addToCart(product){
      if (!product || !product.id) {
        alert('Sản phẩm không hợp lệ');
        return;
      }
      const cart = getCart();
      const idx = cart.findIndex(i => i.id === product.id);
      if (idx !== -1){
        cart[idx].quantity = (cart[idx].quantity || 0) + 1;
      } else {
        cart.push({
          id: product.id,
          name: product.name,
          brand: product.brand || '',
          price: Number(product.price) || 0,
          image: product.image || '',
          quantity: 1
        });
      }
      setCart(cart);
      alert('Đã thêm vào giỏ hàng!');
    }

    function buyNow(product){
      addToCart(product);
      // redirect to cart page
      window.location.href = 'cart.html';
    }
  </script>

</body>
</html>




