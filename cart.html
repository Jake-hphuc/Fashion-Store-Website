<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Gi·ªè H√†ng - Noir Voyage</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" />
  <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@600&family=Montserrat&display=swap" rel="stylesheet" />
  <style>
    body { font-family: 'Montserrat', sans-serif; background-color: #f9f9f9; color: #333; }
    h2.section-title { font-family: 'Playfair Display', serif; font-size: 2.2rem; margin-bottom: 2rem; text-align: center; }
    .cart-img { width: 80px; height: auto; border-radius: 10px; }
    .cart-total { font-size: 1.2rem; font-weight: bold; }
    .table > :not(caption) > * > * { vertical-align: middle; }
    /* delivery hidden by default */
    #delivery-section { display: none; }
  </style>
</head>
<body>
  <!-- Navbar -->
  <nav class="navbar navbar-expand-lg navbar-light bg-white shadow-sm">
    <div class="container">
      <a class="navbar-brand" href="index.html">NOIR VOYAGE</a>
      <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
        <span class="navbar-toggler-icon"></span>
      </button>
      <div class="collapse navbar-collapse justify-content-end" id="navbarNav">
        <ul class="navbar-nav">
          <li class="nav-item"><a class="nav-link" href="thoitrang.html">Trang Ch·ªß</a></li>
        </ul>
      </div>
    </div>
  </nav>

  <!-- Demo th√™m s·∫£n ph·∫©m -->
  <div class="container mt-4 text-center">
    <button class="btn btn-outline-dark" onclick="addSampleProduct()">Th√™m s·∫£n ph·∫©m m·∫´u</button>
  </div>

  <section class="container py-5">
    <h2 class="section-title">Gi·ªè H√†ng C·ªßa B·∫°n</h2>

    <div class="table-responsive">
      <table class="table table-bordered align-middle text-center">
        <thead class="table-dark">
          <tr>
            <th>·∫¢nh</th>
            <th>S·∫£n ph·∫©m</th>
            <th>S·ªë l∆∞·ª£ng</th>
            <th>Gi√°</th>
            <th>T·ªïng c·ªông</th>
            <th>X√≥a</th>
          </tr>
        </thead>
        <tbody id="cart-body">
          <!-- D·ªØ li·ªáu gi·ªè h√†ng ƒë∆∞·ª£c ch√®n b·∫±ng JavaScript -->
        </tbody>
      </table>
    </div>

    <div class="row justify-content-end mt-4">
      <div class="col-md-4">
        <ul class="list-group mb-3">
          <li class="list-group-item d-flex justify-content-between">
            <span>T·ªïng c·ªông</span>
            <strong class="cart-total" id="cart-total">0‚Ç´</strong>
          </li>
        </ul>
        <div class="d-grid gap-2">
          <button class="btn btn-dark w-100" id="btnCheckout" data-bs-toggle="modal" data-bs-target="#checkoutModal">Ti·∫øn H√†nh Thanh To√°n</button>
          <button class="btn btn-outline-secondary w-100" onclick="clearCart()">X√≥a to√†n b·ªô</button>
        </div>
      </div>
    </div>
  </section>

  <!-- Checkout Modal -->
  <div class="modal fade" id="checkoutModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-lg modal-dialog-centered">
      <div class="modal-content">
        <form id="checkoutForm">
          <div class="modal-header">
            <h5 class="modal-title">Thanh to√°n & Giao h√†ng</h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="ƒê√≥ng"></button>
          </div>
          <div class="modal-body">
            <div class="row g-3">
              <div class="col-md-6">
                <label class="form-label">H·ªç v√† t√™n <span class="text-danger">*</span></label>
                <input required type="text" id="custName" class="form-control" placeholder="Nguy·ªÖn VƒÉn A">
              </div>
              <div class="col-md-6">
                <label class="form-label">S·ªë ƒëi·ªán tho·∫°i <span class="text-danger">*</span></label>
                <input required type="tel" id="custPhone" class="form-control" placeholder="0909 123 456">
              </div>
              <div class="col-12">
                <label class="form-label">ƒê·ªãa ch·ªâ giao h√†ng <span class="text-danger">*</span></label>
                <input required type="text" id="custAddress" class="form-control" placeholder="S·ªë nh√†, ƒë∆∞·ªùng, qu·∫≠n, th√†nh ph·ªë">
              </div>

              <div class="col-12">
                <label class="form-label">Ph∆∞∆°ng th·ª©c thanh to√°n</label>
                <div>
                  <div class="form-check form-check-inline">
                    <input class="form-check-input" type="radio" name="paymentMethod" id="payCash" value="cash" checked>
                    <label class="form-check-label" for="payCash">Ti·ªÅn m·∫∑t (COD)</label>
                  </div>
                  <div class="form-check form-check-inline">
                    <input class="form-check-input" type="radio" name="paymentMethod" id="payCard" value="card">
                    <label class="form-check-label" for="payCard">Th·∫ª ATM / Th·∫ª t√≠n d·ª•ng (m√¥ ph·ªèng)</label>
                  </div>
                </div>
              </div>

              <!-- Card fields (m√¥ ph·ªèng) -->
              <div id="cardFields" class="col-12" style="display:none;">
                <div class="row g-2">
                  <div class="col-md-6">
                    <label class="form-label">S·ªë th·∫ª</label>
                    <input type="text" id="cardNumber" class="form-control" placeholder="1234 5678 9012 3456">
                  </div>
                  <div class="col-md-3">
                    <label class="form-label">H·∫°n d√πng</label>
                    <input type="text" id="cardExpiry" class="form-control" placeholder="MM/YY">
                  </div>
                  <div class="col-md-3">
                    <label class="form-label">CVV</label>
                    <input type="text" id="cardCVV" class="form-control" placeholder="123">
                  </div>
                </div>
              </div>

              <div class="col-12">
                <label class="form-label">Ghi ch√∫ (kh√¥ng b·∫Øt bu·ªôc)</label>
                <textarea id="orderNote" class="form-control" rows="2" placeholder="V√≠ d·ª•: giao bu·ªïi chi·ªÅu..."></textarea>
              </div>

              <div class="col-12">
                <div class="alert alert-light">
                  <strong>T·ªïng ƒë∆°n:</strong> <span id="modalTotal">0‚Ç´</span>
                </div>
              </div>
            </div>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">H·ªßy</button>
            <button type="submit" class="btn btn-primary">X√°c nh·∫≠n ƒë∆°n h√†ng</button>
          </div>
        </form>
      </div>
    </div>
  </div>

  <!-- Delivery / Tracking (·∫©n tr∆∞·ªõc khi checkout) -->
  <section id="delivery-section" class="container mt-5 mb-5">
    <h3>üöö Theo d√µi ƒë∆°n h√†ng</h3>
    <div id="order-info" class="p-3 mb-3 border rounded bg-light"></div>

    <h5>üõ£Ô∏è H√†nh tr√¨nh giao h√†ng</h5>
    <div class="delivery-track position-relative mt-3 mb-3" style="height: 80px;">
      <div class="track-line bg-secondary" style="height: 4px; position: absolute; top: 38px; left: 30px; right: 30px;"></div>

      <div class="position-absolute text-center" style="left: 0;">
        <div>üè≠<br><small>Kho Q7</small></div>
      </div>

      <div class="position-absolute text-center" style="right: 0;">
        <div>üè†<br><small>Nh√† kh√°ch</small></div>
      </div>

      <div id="delivery-truck" class="position-absolute" style="top: 20px; left: 0; font-size: 28px;">üõª</div>
    </div>

    <div class="mt-3">
      <p><strong>Tr·∫°ng th√°i:</strong> <span id="status-text">Ch∆∞a c√≥</span></p>
    </div>
  </section>

  <script>
    // Utility
    function formatPrice(number) {
      return Number(number || 0).toLocaleString('vi-VN') + '‚Ç´';
    }

    // CART RENDER
    function renderCart() {
      const cartBody = document.getElementById("cart-body");
      const cart = JSON.parse(localStorage.getItem("cart")) || [];
      cartBody.innerHTML = "";
      let total = 0;

      cart.forEach((item, index) => {
        const itemTotal = item.quantity * item.price;
        total += itemTotal;

        const row = `
          <tr>
            <td><img src="${item.image || 'https://via.placeholder.com/80x80?text=No+Image'}" class="cart-img" alt="${item.name}" onerror="this.src='https://via.placeholder.com/80x80?text=No+Image'"></td>
            <td class="text-start">
              <strong>${item.name}</strong><br>
              <small class="text-muted">${item.brand || ''}</small>
            </td>
            <td>
              <div class="d-flex justify-content-center align-items-center">
                <button class="btn btn-sm btn-outline-secondary me-2" onclick="updateQty(${index}, -1)">‚àí</button>
                <span>${item.quantity}</span>
                <button class="btn btn-sm btn-outline-secondary ms-2" onclick="updateQty(${index}, 1)">+</button>
              </div>
            </td>
            <td>${formatPrice(item.price)}</td>
            <td>${formatPrice(itemTotal)}</td>
            <td><button class="btn btn-sm btn-danger" onclick="removeItem(${index})">X√≥a</button></td>
          </tr>
        `;
        cartBody.innerHTML += row;
      });

      document.getElementById("cart-total").innerText = formatPrice(total);
      // update modal total if open
      const modalTotal = document.getElementById("modalTotal");
      if (modalTotal) modalTotal.innerText = formatPrice(total);
    }

    function updateQty(index, delta) {
      const cart = JSON.parse(localStorage.getItem("cart")) || [];
      if (!cart[index]) return;
      cart[index].quantity = Math.max(1, (cart[index].quantity || 1) + delta);
      localStorage.setItem("cart", JSON.stringify(cart));
      renderCart();
    }

    function removeItem(index) {
      const cart = JSON.parse(localStorage.getItem("cart")) || [];
      cart.splice(index, 1);
      localStorage.setItem("cart", JSON.stringify(cart));
      renderCart();
    }

    function clearCart() {
      if (!confirm('X√°c nh·∫≠n x√≥a to√†n b·ªô gi·ªè h√†ng?')) return;
      localStorage.removeItem('cart');
      renderCart();
    }

    // Demo add sample
    function addSampleProduct() {
      const cart = JSON.parse(localStorage.getItem("cart")) || [];
      const sampleProduct = {
        id: 'sample001',
        name: "√Åo Blazer Zegna",
        brand: "Zegna",
        price: 5500000,
        quantity: 1,
        image: "https://i.pinimg.com/564x/64/25/f5/6425f5c5b5f24c6c2fa9d174ae22a4cb.jpg"
      };
      const idx = cart.findIndex(i => i.id === sampleProduct.id);
      if (idx !== -1) cart[idx].quantity += 1;
      else cart.push(sampleProduct);
      localStorage.setItem("cart", JSON.stringify(cart));
      renderCart();
    }

    // CHECKOUT LOGIC
    document.addEventListener('DOMContentLoaded', function(){
      renderCart();

      // show/hide card fields when radio changed
      document.querySelectorAll('input[name="paymentMethod"]').forEach(r => {
        r.addEventListener('change', function(){
          const cardFields = document.getElementById('cardFields');
          if (this.value === 'card') cardFields.style.display = 'block';
          else cardFields.style.display = 'none';
        });
      });

      // pre-fill modal total on open
      const checkoutModal = document.getElementById('checkoutModal');
      checkoutModal.addEventListener('show.bs.modal', function () {
        const cart = JSON.parse(localStorage.getItem('cart')) || [];
        const total = cart.reduce((s,i) => s + (i.price * i.quantity), 0);
        document.getElementById('modalTotal').innerText = formatPrice(total);
      });

      // handle form submit
      document.getElementById('checkoutForm').addEventListener('submit', function(e){
        e.preventDefault();
        handleCheckoutSubmit();
      });
    });

    function handleCheckoutSubmit() {
      const name = document.getElementById('custName').value.trim();
      const phone = document.getElementById('custPhone').value.trim();
      const address = document.getElementById('custAddress').value.trim();
      const payment = document.querySelector('input[name="paymentMethod"]:checked').value;
      const note = document.getElementById('orderNote').value.trim();

      if (!name || !phone || !address) {
        alert('Vui l√≤ng ƒëi·ªÅn ƒë·∫ßy ƒë·ªß h·ªç t√™n, s·ªë ƒëi·ªán tho·∫°i v√† ƒë·ªãa ch·ªâ.');
        return;
      }

      if (payment === 'card') {
        // basic check (m√¥ ph·ªèng)
        const cardNumber = document.getElementById('cardNumber').value.trim();
        const cardExpiry = document.getElementById('cardExpiry').value.trim();
        const cardCVV = document.getElementById('cardCVV').value.trim();
        if (!cardNumber || !cardExpiry || !cardCVV) {
          if(!confirm('B·∫°n ch∆∞a nh·∫≠p th√¥ng tin th·∫ª. Ti·∫øp t·ª•c m√¥ ph·ªèng thanh to√°n?')) return;
        }
      }

      const cart = JSON.parse(localStorage.getItem('cart')) || [];
      if (cart.length === 0) { alert('Gi·ªè h√†ng ƒëang tr·ªëng.'); return; }

      const total = cart.reduce((s,i) => s + (i.price * i.quantity), 0);
      const orderId = 'NOIR' + Date.now();

      const order = {
        id: orderId,
        customer: { name, phone, address },
        items: cart,
        total,
        paymentMethod: payment,
        note,
        status: 'ƒê√£ x√°c nh·∫≠n',
        createdAt: new Date().toISOString()
      };

      // save orders list
      const orders = JSON.parse(localStorage.getItem('orders')) || [];
      orders.push(order);
      localStorage.setItem('orders', JSON.stringify(orders));

      // clear cart
      localStorage.removeItem('cart');

      // close modal
      const modalEl = document.getElementById('checkoutModal');
      const modal = bootstrap.Modal.getInstance(modalEl);
      modal.hide();

      // show confirmation and start delivery tracking
      alert('ƒê·∫∑t h√†ng th√†nh c√¥ng! M√£ ƒë∆°n: ' + orderId);
      renderCart();
      startDeliverySimulation(order);
    }

    // DELIVERY SIMULATION
    let truckInterval = null;
    let statusInterval = null;
    function startDeliverySimulation(order) {
      // populate order info
      document.getElementById('order-info').innerHTML = `
        <p><strong>M√£ ƒë∆°n:</strong> ${order.id}</p>
        <p><strong>Ng∆∞·ªùi nh·∫≠n:</strong> ${order.customer.name} ‚Äî ${order.customer.phone}</p>
        <p><strong>ƒê·ªãa ch·ªâ:</strong> ${order.customer.address}</p>
        <p><strong>Thanh to√°n:</strong> ${order.paymentMethod === 'cash' ? 'Ti·ªÅn m·∫∑t (COD)' : 'Th·∫ª (m√¥ ph·ªèng)'}</p>
        <p><strong>T·ªïng:</strong> ${formatPrice(order.total)}</p>
      `;

      // show delivery section
      document.getElementById('delivery-section').style.display = 'block';
      document.getElementById('status-text').innerText = 'ƒê√£ x√°c nh·∫≠n';

      // reset truck
      const truck = document.getElementById('delivery-truck');
      let progress = 0;
      truck.style.left = '0';

      if (truckInterval) clearInterval(truckInterval);
      truckInterval = setInterval(() => {
        if (progress <= 100) {
          truck.style.left = `calc(${progress}% - 15px)`;
          progress += 0.8; // t·ªëc ƒë·ªô
        } else {
          clearInterval(truckInterval);
        }
      }, 80);

      // update statuses
      const statuses = [
        "ƒê√£ x√°c nh·∫≠n",
        "ƒê√£ ƒë√≥ng g√≥i",
        "ƒê√£ b√†n giao cho ƒë∆°n v·ªã v·∫≠n chuy·ªÉn",
        "ƒêang giao",
        "Giao th√†nh c√¥ng"
      ];
      let currentStatus = 0;
      if (statusInterval) clearInterval(statusInterval);
      statusInterval = setInterval(() => {
        if (currentStatus < statuses.length) {
          document.getElementById('status-text').innerText = statuses[currentStatus];
          currentStatus++;
        } else {
          clearInterval(statusInterval);
        }
      }, 4000);
    }

    // initial render
    renderCart();
  </script>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>




